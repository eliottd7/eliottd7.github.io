<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Welcome!</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
<canvas id="main_board" width="500" height="500"></canvas>

<script>

    canvas_size = 500
    particle_size = 1.5
    velocity_cap = 1

    field = document.getElementById("main_board").getContext('2d')

    draw = (x, y, color, s) => {
        field.fillStyle = color
        field.fillRect(x, y, s, s)
    }

    particles = []
    particle = (x, y, color, border_type) => {
        return {
            "x":x,
            "y":y,
            "vx":0,
            "vy":0,
            "color":color,
            "border":border_type
        }
    }

    random = () => {
        return Math.random() * 480 + 10
    }

    create = (number, color, border) => {
        group = []
        for (let i = 0; i < number; i++){
            group.push(particle(random(), random(), color, border))
            particles.push(group[i])
        }
        return group
    }

    rule = (part1, part2, g) => {
        for(let i = 0; i < part1.length; i++){
            fx = 0
            fy = 0

            for(let j = 0; j < part2.length; j++){
                a = part1[i]
                b = part2[j]

                dx = a.x - b.x
                dy = a.y - b.y
                d = Math.sqrt(dx * dx + dy * dy)

                if (d > 0) {
                    F = g * 1 / d
                    fx += (F * dx)
                    fy += (F * dy)
                }

                a.vx = (a.vx + fx)
                a.vy = (a.vy + fy)

                if(a.vx > velocity_cap) a.vx = velocity_cap
                else if(a.vx < 0-velocity_cap) a.vx = 0-velocity_cap

                if(a.vy > velocity_cap) a.vy = velocity_cap
                else if(a.vy < 0-velocity_cap) a.vy = 0-velocity_cap

                a.x += a.vx
                a.y += a.vy

                
                if(a.border){
                    if (a.x < 0) {
                        a.x = 0
                        a.vx = -a.vx
                    }
                    else if (a.x > canvas_size){
                        a.x = canvas_size
                        a.vx = -a.vx
                    }

                    if (a.y < 0) {
                        a.y = 0
                        a.vy = -a.vy
                    }
                    else if (a.y > canvas_size){
                        a.y = canvas_size
                        a.vy = -a.vy
                    }
                } else {
                    if (a.x < 0) a.x = canvas_size
                    else if (a.x > canvas_size) a.x = 0
                    if (a.y < 0) a.y = canvas_size
                    else if (a.y > canvas_size) a.y = 0
                }
            }
        }
    }

    update = () => {
        // rule(yellow, yellow, -0.001)
        rule(green, yellow, -0.005)

        field.clearRect(0, 0, canvas_size, canvas_size)
        draw(0, 0, "black", canvas_size)

        for(i = 0; i < particles.length; i++){
            draw(particles[i].x, particles[i].y, particles[i].color, particle_size)
        }
        requestAnimationFrame(update)

    }

    // color = black if "hidden"
    green = create(10000, "green", false)
    yellow = create(5, "black", false)
    update();

</script>
  </body>
</html>
